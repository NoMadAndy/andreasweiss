<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Passwort zur√ºcksetzen ‚Äì {{ candidate.name }}</title>
<link rel="icon" type="image/svg+xml" href="/{{ candidate.slug }}/favicon.svg">
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;background:#f0f2f5;color:#1d1d1f;min-height:100vh;display:flex;align-items:center;justify-content:center}
.card{background:#fff;padding:2.5rem;border-radius:16px;box-shadow:0 4px 24px rgba(0,0,0,.08);width:100%;max-width:420px;margin:1rem}
.card h1{font-size:1.5rem;margin-bottom:.25rem;font-weight:700}
.card .sub{color:#6e6e73;font-size:.85rem;margin-bottom:1.5rem}
.card input{display:block;width:100%;padding:.85rem 1rem;border:1.5px solid #e0e0e0;border-radius:10px;font-size:1rem;margin-bottom:.75rem;transition:border-color .2s}
.card input:focus{outline:none;border-color:#1e6fb9;box-shadow:0 0 0 3px rgba(30,111,185,.12)}
.card button{display:block;width:100%;padding:.85rem;background:linear-gradient(135deg,#16a34a,#15803d);color:#fff;border:none;border-radius:10px;font-size:1rem;cursor:pointer;font-weight:600;font-family:inherit}
.card button:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(22,163,74,.25)}
.card button:disabled{opacity:.6;transform:none}
.msg{font-size:.88rem;text-align:center;margin-top:.75rem;min-height:1.2em}
.msg.ok{color:#16a34a}.msg.err{color:#dc2626}
.expired{text-align:center;padding:1rem 0}
.expired h2{font-size:1.2rem;color:#dc2626;margin-bottom:.5rem}
.expired p{color:#6e6e73;font-size:.9rem}
a.back{display:inline-block;margin-top:1.5rem;color:#1e6fb9;text-decoration:none;font-size:.88rem;font-weight:500}
a.back:hover{text-decoration:underline}
</style>
</head>
<body>
<div class="card">
{% if valid %}
  <h1>üîë Neues Passwort</h1>
  <p class="sub">{{ candidate.name }}</p>
  <input type="password" id="new-pass" placeholder="Neues Passwort (mind. 6 Zeichen)" autocomplete="new-password" autofocus>
  <input type="password" id="new-pass2" placeholder="Passwort wiederholen" autocomplete="new-password">
  <button id="reset-btn">Passwort speichern</button>
  <p class="msg" id="msg"></p>
{% else %}
  <div class="expired">
    <h2>‚ö†Ô∏è Link ung√ºltig oder abgelaufen</h2>
    <p>Der Passwort-Reset-Link ist nicht mehr g√ºltig. Bitte fordere einen neuen an.</p>
  </div>
{% endif %}
  <div style="text-align:center">
    <a class="back" href="/{{ candidate.slug }}/admin/">‚Üê Zum Admin-Login</a>
  </div>
</div>

{% if valid %}
<script>
(function(){
  var SLUG="{{ candidate.slug }}";
  var TOKEN="{{ token }}";
  var btn=document.getElementById("reset-btn");
  var msg=document.getElementById("msg");
  var p1=document.getElementById("new-pass");
  var p2=document.getElementById("new-pass2");

  btn.addEventListener("click",doReset);
  p2.addEventListener("keydown",function(e){if(e.key==="Enter")doReset()});

  function doReset(){
    msg.textContent="";msg.className="msg";
    var pw=p1.value,pw2=p2.value;
    if(!pw||pw.length<6){msg.className="msg err";msg.textContent="Passwort muss mind. 6 Zeichen haben";return}
    if(pw!==pw2){msg.className="msg err";msg.textContent="Passw√∂rter stimmen nicht √ºberein";return}
    btn.disabled=true;btn.textContent="Speichern‚Ä¶";
    fetch("/api/"+SLUG+"/reset-password",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({token:TOKEN,new_pass:pw})
    })
    .then(function(r){return r.json().then(function(d){return{ok:r.ok,data:d}})})
    .then(function(res){
      if(res.ok){
        msg.className="msg ok";
        msg.textContent="‚úÖ Passwort wurde ge√§ndert! Du wirst zum Login weitergeleitet‚Ä¶";
        setTimeout(function(){window.location.href="/"+SLUG+"/admin/"},2000);
      } else {
        msg.className="msg err";
        msg.textContent="‚ùå "+(res.data.detail||"Fehler");
        btn.disabled=false;btn.textContent="Passwort speichern";
      }
    })
    .catch(function(){
      msg.className="msg err";msg.textContent="‚ùå Netzwerkfehler";
      btn.disabled=false;btn.textContent="Passwort speichern";
    });
  }
})();
</script>
{% endif %}
</body>
</html>
